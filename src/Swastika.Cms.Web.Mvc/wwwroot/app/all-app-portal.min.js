"use strict";var app=angular.module("SwastikaPortal",[]),serviceBase="/";app.directive("ngEnter",function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.ngEnter)}),t.preventDefault())})}}).directive("file",function(){return{scope:{file:"="},link:function(n,t){t.bind("change",function(t){var i=t.target.files,r=i[0];n.file=r;n.$apply()})}}});app.controller("PortalController",function(n){n.mediaData={};n.mediaFile={file:null,fullPath:"",folder:"Media",title:"",description:""};n.templates=[];n.medias=[];n.productData={};n.activedTemplate={};n.activedMedias=[];n.activedProducts=[];n.request={pageSize:10,pageIndex:0,orderBy:"CreatedDateTime",direction:1,keyword:""};n.settings={async:!0,crossDomain:!0,url:"",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:n.request};n.range=function(n){for(var i=[],t=1;t<=n;t+=1)i.push(t);return i};n.loadMedia=function(t){t!=undefined&&(n.request.pageIndex=t);n.settings.url="/api/vi-vn/media/list";n.settings.data=n.request;$.ajax(n.settings).done(function(t){n.$apply(n.mediaData=t.data);$.each(n.mediaData.items,function(t,i){$.each(n.activedMedias,function(n,t){t.mediaId==i.id&&(i.isHidden=!0)})})})};n.uploadMedia=function(){if(n.mediaFile.file!==undefined&&n.mediaFile.file!==null){var t=new FormData;t.append(n.mediaFile.file.name,n.mediaFile.file);t.append("fileFolder",n.mediaFile.folder);t.append("title",n.mediaFile.title);t.append("description",n.mediaFile.description);$.ajax({url:"/api/vi-vn/media/upload",type:"POST",contentType:!1,processData:!1,data:t,success:function(t){if(t.isSucceed)return n.mediaFile.file=null,n.loadMedia(),$(".upload-image-modal-lg").modal("hide"),t},error:function(){return""}})}};n.removeMedia=function(t){if(confirm("Are you sure!")){var i="/api/vi-vn/media/delete/"+t;$.ajax({method:"GET",url:i,success:function(){n.loadMedia()},error:function(n,t,i){console.log(n+" "+t+" "+i)}})}};n.saveMedia=function(n){$.ajax({method:"POST",url:"/api/vi-vn/media/save",data:n,success:function(n){n.isSucceed?alert("success"):alert("failed! "+n.errors)},error:function(n,t,i){console.log(n+" "+t+" "+i)}})};n.loadProduct=function(t=0,i=16,r="title",u=0){var f={pageSize:i,pageIndex:t,orderBy:r,direction:u,keyword:$("#keyword").val()};n.settings.url="/api/vi-vn/product/list";n.settings.data=f;$.ajax(n.settings).done(function(t){n.productData=t.data})};n.changeMedia=function(t){var i=null;n.activedMedias==undefined&&(n.activedMedias=[]);$.each(n.activedMedias,function(n,r){if(r.mediaId==t.id)return r.isActived=t.isActived,i=r,!1});i==null&&(i={description:t.description,image:t.fullPath,mediaId:t.id,product:$("#product-id").val(),specificulture:t.specificulture,position:0,priority:n.activedMedias.length+1,isActived:!0},t.isHidden=!0,n.activedMedias.push(i))};n.changeProduct=function(t){var i=null;$.each(n.activedProducts,function(n,r){if(r.relatedProductId==t.id)return r.isActived=t.isActived,i=r,!1});i==null&&(i={relatedProductId:t.id,sourceProductId:$("#product-id").val(),specificulture:t.specificulture,priority:n.activedMedias.length+1,product:t,isActived:!0},t.isHidden=!0,n.activedProducts.push(i))};n.addProperty=function(n){var t=$(".property").length;$.ajax({method:"GET",url:"/vi-vn/Portal/"+n+"/AddEmptyProperty/"+t,success:function(n){$("#tbl-properties > tbody").append(n);$(n).find(".prop-data-type").trigger("change")},error:function(n,t,i){console.log(n+" "+t+" "+i)}})};n.loadTemplates=function(t,i){var r={pageSize:null,pageIndex:0,orderBy:"fileName",direction:0,keyword:i};n.settings.url="/api/vi-vn/template/list";n.settings.data=r;$.ajax(n.settings).done(function(i){if(n.templates=i.data.items,n.templates.length>0){var r=angular.copy(n.templates[0]);r.id=0;r.fileName="NewTemplate";r.content="<div><\/div>";n.templates.splice(0,0,r)}$.each(n.templates,function(i,r){if(r.id==t)return n.activedTemplate=r,n.updateEditors(),!1});n.$apply()})};n.updateEditors=function(){setTimeout(function(){$.each($(".code-editor"),function(n,t){var r=$(this),i=ace.edit(t),u=$(this).next("input").val();i.setValue(u);r.hasClass("json")?i.session.setMode("ace/mode/json"):i.session.setMode("ace/mode/razor");i.setTheme("ace/theme/chrome");i.session.setUseWrapMode(!0);i.setOptions({maxLines:Infinity});i.getSession().on("change",function(){$(r).parent().find(".code-content").val(i.getValue())})})},200)};$(document).ready(function(){})});